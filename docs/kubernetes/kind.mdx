---
title: "Deploy with kind"
date: 2024-08-08T00:00:00+00:00
icon: 'ti-anchor' # themify icon pack : https://themify.me/themify-icons
description: 'Deploy wasmCloud on a local kind cluster'
sidebar_position: 0
type: 'docs'
---

## Overview

[**kind**](https://kind.sigs.k8s.io/) is a Kubernetes distribution designed to run local clusters for local development or CI, using nodes that run as containers.

## Install kind

If you do not already have kind, you can install it with the [Go toolchain](https://go.dev/doc/install). 

```shell
go install sigs.k8s.io/kind@v0.23.0 
```
You may need to add your Go binary folder to your PATH as well: 

```shell
export PATH=${PATH}:`go env GOPATH`/bin
```

kind requires container tooling and supports [Docker](https://www.docker.com/), [podman](https://podman.io/), and [nerdctl](https://github.com/containerd/nerdctl). Once you have the tooling of your choice installed, start a local Kubernetes cluster:

```shell
cat <<EOF | kind create cluster --config=-
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
EOF
```

## Install Helm

This walkthrough requires [Helm](https://helm.sh/), which serves as a package manager for Kubernetes. You can follow the instructions on the [Helm install page](https://helm.sh/docs/intro/install/) or use the project's install script:

```shell
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod 700 get_helm.sh
./get_helm.sh
```

## Install wash

Once wasmCloud is deployed to your kind cluster, you can use the **wasmCloud Shell (`wash`)** CLI to manage wasmCloud applications. If you do not have `wash` installed locally already, follow the instructions on the [install page](https://wasmcloud.com/docs/installation).

## Deploying wasmCloud

Once a `kind` cluster is running locally, you can run wasmCloud on Kubernetes with the [wasmCloud Kubernetes operator](https://github.com/wasmCloud/wasmcloud-operator). (An operator is TK&mdash;you can [learn more about the Kubernetes operator pattern in the Kubernetes documentation](https://kubernetes.io/docs/concepts/extend-kubernetes/operator/).)

Before installing the operator, it is necessary to install two prerequisites:

- A **[NATS](/docs/ecosystem/nats/) cluster** (with Jetstream enabled)
- **[wasmCloud Application Deployment Manager (wadm)](/docs/ecosystem/wadm/)** 

The following steps will help you deploy the prerequisites to your Kubernetes cluster, then deploy the operator.

### Deploy NATS

NATS is the open source connective technology that wasmCloud uses to create a unified topology across any number of environments. Add the NATS Helm repository:

```shell
helm repo add nats https://nats-io.github.io/k8s/helm/charts/
```

Install the upstream NATS Helm chart to start a cluster with the `values.yaml` file from the wasmCloud operator repository:

```shell
helm upgrade --install -f https://raw.githubusercontent.com/wasmCloud/wasmcloud-operator/main/examples/quickstart/nats-values.yaml nats nats/nats
```

Validate the installation with:

```shell
kubectl rollout status deploy,sts -l app.kubernetes.io/instance=nats
```

#### Deploy wadm

wasmCloud Application Deployment Manager (wadm) enables declarative application deployment and management for wasmCloud. You can deploy wadm to your Kubernetes cluster with a Helm chart:

```shell
helm install wadm -f https://raw.githubusercontent.com/wasmCloud/wasmcloud-operator/main/examples/quickstart/wadm-values.yaml oci://ghcr.io/wasmcloud/charts/wadm
```

Validate the installation with:

```shell
kubectl rollout status deploy -l app.kubernetes.io/instance=wadm
```

#### Deploy the wasmCloud operator

To deploy the operator:

```shell
kubectl apply -k https://github.com/wasmCloud/wasmcloud-operator/deploy/base
```

Validate the installation with:

```shell
# make sure pods are ready
kubectl rollout status deploy -l app=wasmcloud-operator -n wasmcloud-operator
# apiservice should be available
kubectl get apiservices.apiregistration.k8s.io v1beta1.core.oam.dev
```

### Create wasmCloud host

Apply the `wasmcloud-host` manifest:

```shell
kubectl apply -f https://raw.githubusercontent.com/wasmCloud/wasmcloud-operator/main/examples/quickstart/wasmcloud-host.yaml
```

Check wasmCloud host status:

```shell
kubectl describe wasmcloudhostconfig wasmcloud-host
```

### Run a WebAssembly component on Kubernetes

When you `kubectl apply` a [wasmCloud application manifest](../../docs/ecosystem/wadm/model), the cluster automatically provisions the component workload with wasmCloud. 

This example uses the [`hello-world-application.yaml` manifest](https://raw.githubusercontent.com/wasmCloud/wasmcloud-operator/main/examples/quickstart/hello-world-application.yaml) included in the operator's quickstart. (The [source code for the application](https://github.com/wasmCloud/wasmCloud/tree/main/examples/rust/components/http-hello-world) is available in the wasmCloud repository.)

Below is an excerpt of the manifest:

```yaml {7-7}
...
spec:
  components:
    - name: http-component
      type: component
      properties:
        image: ghcr.io/wasmcloud/components/http-hello-world-rust:0.1.0
...
```
The component is packaged as an OCI artifact and specified in the `image` field. This isn't a container, but a component conforming to OCI standards, meaning that it can be used with existing registries for container images. 

Run `kubectl apply`: 

```shell
kubectl apply -f https://raw.githubusercontent.com/wasmCloud/wasmcloud-operator/main/examples/quickstart/hello-world-application.yaml
```

View the deployment status:

```shell
kubectl get application
```
```text
APPLICATION   DEPLOYED VERSION   LATEST VERSION   STATUS
hello-world   v0.0.1             v0.0.1           Deployed
```

### Manage applications with wash

To connect `wash` to the cluster, port-forward into the NATS service running in your Kubernetes cluster. (Note: `4222` is the port for the NATS service, `4223` is the port for NATS websockets.)

```shell
kubectl port-forward svc/nats 4222:4222 4223:4223
```
Now you can connect to wasmCloud on Kubernetes with your local wash toolchain:

```shell
wash app list
```

View the hello world component running on the Kubernetes cluster, manageable via our local `wash` CLI:

```text
Name          Latest Version   Deployed Version   Deploy Status  Description                                                                                                  
hello-world   v0.0.1           v0.0.1                  Deployed  HTTP hello world demo in Rust, using the WebAssembly Component Model and WebAssembly Interfaces Types (WIT)
```

### Clean up

To delete the kind cluster when you are finished:

```shell
kind delete cluster
```