"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2893],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(a),h=o,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||r;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<r;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},2888:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var n=a(7462),o=(a(7294),a(3905));const r={slug:"2022-05-23_ghcr-actions",title:"Deploying wasmCloud Actors from Github Packages",image:"/img/ghcr-actions/github-packages.png",date:new Date("2022-05-23T13:00:00.000Z"),author:"Brooks Townsend",author_profile:"https://linkedin.com/in/brooks-townsend",description:"Simplifying the deployment experience for WebAssembly modules.",categories:["webassembly","wasmcloud","developer experience"],draft:!1},i=void 0,s={permalink:"/blog/2022-05-23_ghcr-actions",source:"@site/blog/2022-05-23_ghcr-actions.md",title:"Deploying wasmCloud Actors from Github Packages",description:"Simplifying the deployment experience for WebAssembly modules.",date:"2022-05-23T13:00:00.000Z",formattedDate:"May 23, 2022",tags:[],readingTime:5.86,hasTruncateMarker:!0,authors:[{name:"Brooks Townsend"}],frontMatter:{slug:"2022-05-23_ghcr-actions",title:"Deploying wasmCloud Actors from Github Packages",image:"/img/ghcr-actions/github-packages.png",date:"2022-05-23T13:00:00.000Z",author:"Brooks Townsend",author_profile:"https://linkedin.com/in/brooks-townsend",description:"Simplifying the deployment experience for WebAssembly modules.",categories:["webassembly","wasmcloud","developer experience"],draft:!1},prevItem:{title:"wasmCloud Capabilities are Managed Algebraic Effects for WebAssembly Functions",permalink:"/blog/caps_are_effects"}},l={authorsImageUrls:[void 0]},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Pushing an actor to GitHub packages",id:"pushing-an-actor-to-github-packages",level:2},{value:"Continuous integration with a GitHub repository",id:"continuous-integration-with-a-github-repository",level:2},{value:"Wrap up",id:"wrap-up",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],c={toc:u};function p(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"github-packages-logo",src:a(2468).Z,width:"1203",height:"633"})),(0,o.kt)("p",null,"With the general availability of GitHub Packages container registry, or GHCR for short, an easily accessible Docker registry made its way into the same platform many developers use for version control today. This was great news for containers and simplifying infrastructure, just like Actions greatly simplified workflows on GitHub."),(0,o.kt)("p",null,"But wait, there's more!"),(0,o.kt)("p",null,"GitHub container registry also supports the Open Container Initiative (OCI) specification, which doesn't limit \"containers\" to just Docker containers, and it supports public anonymous downloads! This makes GHCR a perfect target for hosting OCI-compliant artifacts, like wasmCloud actors and capability providers. Today, we're going to walk through evolving use cases for getting more power out of this feature of GitHub and how it can simplify your wasmCloud development beyond running on your local machine."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"Today we'll be using a couple of tools for this tutorial:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"li",href:"https://www.rust-lang.org/tools/install"},"Rust"))," toolchain to build actors",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Make sure to add wasm32 as a target with ",(0,o.kt)("inlineCode",{parentName:"li"},"rustup target add wasm32-unknown-unknown")))),(0,o.kt)("li",{parentName:"ul"},".",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"li",href:"https://wasmcloud.dev/overview/installation/#install-wash"},"wash")),", the wasmCloud shell, at least ",(0,o.kt)("inlineCode",{parentName:"li"},"v0.11.0"))),(0,o.kt)("h2",{id:"pushing-an-actor-to-github-packages"},"Pushing an actor to GitHub packages"),(0,o.kt)("p",null,"To start, let's go ahead and generate a new wasmCloud actor project from the ",(0,o.kt)("inlineCode",{parentName:"p"},"hello"),' project template. This is our "hello world" actor.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wash new actor hello\n")),(0,o.kt)("p",null,"Once the project is generated, ",(0,o.kt)("inlineCode",{parentName:"p"},"cd hello")," into the project. There, you can run ",(0,o.kt)("inlineCode",{parentName:"p"},"cargo build --release")," build your actor module. The last step before we can push it to GitHub is to ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://wasmcloud.dev/app-dev/std-caps/#sign-the-actor"},"sign"))," the actor with embedded claims. The following command will sign your actor and allow it to access the HTTPServer capability:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wash claims sign target/wasm32-unknown-unknown/release/hello.wasm --http_server --name Hello\n")),(0,o.kt)("p",null,"By default this will place the actor under the same directory with a ",(0,o.kt)("inlineCode",{parentName:"p"},"_s")," suffix, and you can verify this worked properly by running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wash claims inspect target/wasm32-unknown-unknown/release/hello_s.wasm\n")),(0,o.kt)("p",null,"Your output should be something like this, just with different ",(0,o.kt)("inlineCode",{parentName:"p"},"Account")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Module")," keys"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-plain"},"                              Hello - Module\n  Account       ABYFZKXEHQWJIMBKVAVG3Y5LGEBT3MQXRYVTQBF7RVHUIG62LUK3N5EQ\n  Module        MAMP52XKSBHNDMWK4OR4BZVBDQNNZQ5FXDXUAX7KIT7KNOKK2N3CCLZ2\n  Expires                                                          never\n  Can Be Used                                                immediately\n  Version                                                       None (0)\n  Call Alias                                                   (Not set)\n                               Capabilities\n  HTTP Server\n                                   Tags\n  None\n")),(0,o.kt)("p",null,"Now that we've built and signed your actor, let's push it to GitHub! To do this, you'll need a ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"personal access token"))," with the ",(0,o.kt)("inlineCode",{parentName:"p"},"write:packages")," capability. Refer to the link for instructions on how to create this personal access token, and feel free to tweak the other parameters to your liking."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(3164).Z,width:"1720",height:"1392"})),(0,o.kt)("p",null,"Once created, copy this token and store it in a safe place before moving back to your terminal."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(6378).Z,width:"1732",height:"502"})),(0,o.kt)("p",null,"Now, time to push! We'll use ",(0,o.kt)("inlineCode",{parentName:"p"},"wash")," here along with some environment variables. ",(0,o.kt)("inlineCode",{parentName:"p"},"WASH_REG_USER")," should be set to your GitHub username, and ",(0,o.kt)("inlineCode",{parentName:"p"},"WASH_REG_PASSWORD")," should be set to your GitHub personal access token that you created before, starting with ",(0,o.kt)("inlineCode",{parentName:"p"},"ghp_")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"export WASH_REG_USER=<your_github_username>\nexport WASH_REG_PASSWORD=<your_gitub_personal_access_token>\nwash reg push ghcr.io/$WASH_REG_USER/hello:0.1.0 target/wasm32-unknown-unknown/release/hello_s.wasm\n")),(0,o.kt)("p",null,"You should see output like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-plain"},"wash reg push ghcr.io/$WASH_REG_USER/hello:0.1.0 target/wasm32-unknown-unknown/release/hello_s.wasm\n\n\ud83d\udebf Successfully validated and pushed to ghcr.io/brooksmtownsend/hello:0.1.0\n")),(0,o.kt)("p",null,"Now, you can navigate to your GitHub profile and access the ",(0,o.kt)("inlineCode",{parentName:"p"},"Packages")," tab to see your ",(0,o.kt)("inlineCode",{parentName:"p"},"hello")," actor."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(7375).Z,width:"2056",height:"574"})),(0,o.kt)("p",null,"By default, our actor package is private so that it cannot be downloaded anonymously. Any wasmCloud host can be configured with a username and password for registry authentication, and in this case you can supply your GitHub username and personal access token to authenticate and download your actor. However, this step can be missed easily, so let's make this actor package public so you can start it anywhere. Click on your package, then on the \"",(0,o.kt)("a",{parentName:"p",href:"https://emojipedia.org/gear/"},"\u2699\ufe0f"),' Package Settings" sidebar. From there, scroll to the bottom and "Change visibility" to public.'),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(604).Z,width:"988",height:"782"})),(0,o.kt)("p",null,"Now you can download and run that actor on any wasmCloud host, which can be on Mac, Linux, Windows, or even in a browser tab! You can test connectivity at any time by running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wash claims inspect ghcr.io/<your_github_username>/hello:0.1.0\n")),(0,o.kt)("h2",{id:"continuous-integration-with-a-github-repository"},"Continuous integration with a GitHub repository"),(0,o.kt)("p",null,"Now that we have a Package set up for our actor, the next step is to connect it to a repository. Once we do that we can take advantage of the built-in Actions that are provided with an actor project to automatically build, test, and release actors."),(0,o.kt)("p",null,"First step is to create a GitHub repository. For simplicity, let's call it ",(0,o.kt)("inlineCode",{parentName:"p"},"hello")," to match the actor name."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(4747).Z,width:"1604",height:"1628"})),(0,o.kt)("p",null,"Once that's created, we need to associate our local actor project with the GitHub repository. ",(0,o.kt)("inlineCode",{parentName:"p"},"cd hello")," into your actor project if you haven't already, and then:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git add .\ngit commit -m "initial commit"\ngit branch -M main\n# If you named your repository something else, simply replace the URL below\ngit remote add origin https://github.com/<your_github_name>/hello.git\ngit push -u origin main\n')),(0,o.kt)("p",null,"For every commit after this one, and every pull request into ",(0,o.kt)("inlineCode",{parentName:"p"},"main")," , your actor will be automatically built, checked for formatting, lints, and tested once you add unit tests and uncomment the ",(0,o.kt)("inlineCode",{parentName:"p"},"cargo test")," step in ",(0,o.kt)("inlineCode",{parentName:"p"},".github/workflows/build.yml"),"."),(0,o.kt)("p",null,"For the ",(0,o.kt)("inlineCode",{parentName:"p"},".github/workflows/release.yml")," action, we need to configure three repository secrets to properly sign and release your actor. The good news is, we already have all of these secrets, we just need to plop them in GitHub!"),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(4080).Z,width:"2680",height:"1458"})),(0,o.kt)("p",null,"Under your repository settings, head to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Secrets")," dropdown and click ",(0,o.kt)("inlineCode",{parentName:"p"},"Actions")," . Here we can configure the following secrets for use in this repository."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"th"},"name")),(0,o.kt)("th",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"th"},"value")))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"WASH_ISSUER_KEY"),(0,o.kt)("td",{parentName:"tr",align:null},"Can be found under ",(0,o.kt)("inlineCode",{parentName:"td"},"$HOME/.wash/keys")," with the form of ",(0,o.kt)("inlineCode",{parentName:"td"},"<your_username>_account.nk"),". Copy the contents of this file, a 56 character ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"td",href:"https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth"},"NKey"))," starting with ",(0,o.kt)("inlineCode",{parentName:"td"},"SA"),", into the value section.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"WASH_SUBJECT_KEY"),(0,o.kt)("td",{parentName:"tr",align:null},"Can be found under ",(0,o.kt)("inlineCode",{parentName:"td"},"$HOME/.wash/keys/hello_module.nk"),". Copy the contents of this file, a 56 character ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"td",href:"https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth"},"NKey"))," starting with ",(0,o.kt)("inlineCode",{parentName:"td"},"SM"),", into the value section.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"WASMCLOUD_PAT"),(0,o.kt)("td",{parentName:"tr",align:null},"Your personal access token that you previously used for ",(0,o.kt)("inlineCode",{parentName:"td"},"WASH_REG_PASSWORD"))))),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(9313).Z,width:"1712",height:"538"})),(0,o.kt)("p",null,"Once these three secrets are configured, let's cut our first release of the ",(0,o.kt)("inlineCode",{parentName:"p"},"hello")," actor. Head back to your command line and create a tag for ",(0,o.kt)("inlineCode",{parentName:"p"},"v0.1.0")," and push it to ",(0,o.kt)("inlineCode",{parentName:"p"},"main")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git tag -a v0.1.0 -m "initial release for hello actor"\ngit push -u origin v0.1.0\n')),(0,o.kt)("p",null,"This will automatically kick off the release action, which includes building and testing the actor just like the build action, and after a few minutes you'll see a new GitHub release created with the OCI URL for the actor and claims information, as well as the ",(0,o.kt)("inlineCode",{parentName:"p"},"hello")," package associated with this repo."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(1536).Z,width:"2844",height:"1878"})),(0,o.kt)("h2",{id:"wrap-up"},"Wrap up"),(0,o.kt)("p",null,"Today we walked through the setup process to configure a GitHub repository to automatically build, test, and release wasmCloud actors to GitHub Packages. You can continue to add to these base workflow templates to include your own custom checks as well."),(0,o.kt)("h2",{id:"whats-next"},"What's next?"),(0,o.kt)("p",null,"Now that your ",(0,o.kt)("inlineCode",{parentName:"p"},"hello")," actor is published to a public OCI registry, you can follow our ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://wasmcloud.dev/app-dev/create-actor/run/"},"run actor"))," tutorial with the OCI reference instead of uploading a local file. If you're new to wasmCloud, check out our documentation for helpful information about ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://wasmcloud.dev/reference/host-runtime/actors/"},"actors")),", our ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://wasmcloud.dev/reference/host-runtime/security/"},"security model")),", and more. Feedback on this process is welcome and encouraged on our ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/wasmcloud/project-templates"},"project-templates"))," repo; and to stay involved you can join our ",(0,o.kt)("u",null,(0,o.kt)("a",{parentName:"p",href:"https://slack.wasmcloud.com/"},"slack")),"."))}p.isMDXComponent=!0},604:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/change-visibility-ec2677df4d134329e9fd44b43ada1f11.png"},4747:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-repo-fda05baf6274b48407e55d6f24763419.png"},2468:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/github-packages-a2ea3a52ed3e00db8f2f7291888cafaa.png"},3164:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/new-pat-decf93e4c9d618db626b80586bb8a90e.png"},7375:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/package-21622403a62a48bd805ec847e43e7da6.png"},6378:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/pat-created-9cc806bae6e55bbd45e53aa941378c6c.png"},1536:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/release-b19d34e08b6c7f78f1e96906eaf1d865.png"},4080:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/repo-secrets-0bfb27c1410e8fc88645b31b25a985d4.png"},9313:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/required-secrets-d314cf96d604bb5d9c491ec86c9f4291.png"}}]);